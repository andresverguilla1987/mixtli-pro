<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mixtli — Subir y Compartir</title>
</head>
<body>
  <h1>Mixtli — Subir y compartir</h1>
  <input id="file" type="file" />
  <button id="btnUpload">Subir y generar enlace</button>
  <pre id="log"></pre>
<script>
async function doPresign(file){
  const url = "https://mixtli-pro.onrender.com/presign";
  const r = await fetch(url, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ filename: file.name, contentType: file.type, size: file.size })
  });
  return r.json();
}
async function upload(file, presign){
  const r = await fetch(presign.url, {method:"PUT", headers:{"Content-Type":file.type}, body:file});
  return r.status;
}
document.getElementById("btnUpload").onclick = async ()=>{
  const file = document.getElementById("file").files[0];
  const log = document.getElementById("log");
  log.textContent = "Subiendo " + file.name + "...\n";
  try{
    const presign = await doPresign(file);
    log.textContent += JSON.stringify(presign,null,2)+"\n";
    const status = await upload(file, presign);
    log.textContent += "PUT status: "+status+"\n";
    log.textContent += "Public URL: "+presign.publicUrl+"\n";
  }catch(e){ log.textContent += "Error: "+e.message; }
};
</script>
</body>
</html>
