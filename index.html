<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mixtli Fix</title>
</head>
<body>
  <h2>Mixtli Front Fix</h2>
  <input type="file" id="fileInput" />
  <button onclick="handleUpload()">Subir y generar enlace</button>

  <script>
    const API_BASE = "https://mixtli-pro.onrender.com";
    const PRESIGN_PATH = "/presign"; // cÃ¡mbialo si tu server usa /api/uploads/presign

    async function doPresign(file) {
      const r = await fetch(API_BASE + PRESIGN_PATH, {
        method: "POST",
        mode: "cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          filename: file.name,
          contentType: file.type,
          size: file.size
        })
      });
      if (!r.ok) {
        const txt = await r.text().catch(() => "");
        throw new Error("Presign " + r.status + " :: " + txt);
      }
      return r.json();
    }

    async function uploadWithPresign(file) {
      const { url, method = "PUT", headers = {} } = await doPresign(file);
      const put = await fetch(url, { method, headers, body: file });
      if (!put.ok) {
        const t = await put.text().catch(() => "");
        throw new Error("PUT " + put.status + " :: " + t);
      }
      alert("Archivo subido: " + url);
    }

    async function handleUpload() {
      const f = document.getElementById("fileInput").files[0];
      if (!f) return alert("Selecciona un archivo primero.");
      try {
        await uploadWithPresign(f);
      } catch (err) {
        alert("Error en subida: " + err.message);
      }
    }
  </script>
</body>
</html>