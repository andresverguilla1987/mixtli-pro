(function(){const $=q=>document.querySelector(q);const cfg=window.MIXTLI_CFG;const grid=$('#plans');const sel=$('#country');const q=$('#crypto-quote');function priceTag(a,c){return `<div class='row' style='align-items:baseline;gap:6px;margin-top:6px'><div class='badge' style='background:linear-gradient(90deg,#22d3ee,#34d399);color:#042018'>$${a} ${c}</div>${c==='MXN'?'<span class="meta">≈ $'+(a/17).toFixed(2)+' USD</span>':''}</div>`;}function render(){grid.innerHTML='';cfg.products.forEach((p,i)=>{const price=p.price[sel.value]??'?';const el=document.createElement('div');el.className='card';el.innerHTML=`<div class='shine'></div><div class='title'>${p.title}</div><div class='meta'>País: ${cfg.country} • Moneda: ${sel.value} • Método: <span id='m-${p.id}'>stripe</span></div>${priceTag(price,sel.value)}<hr class='sep'/><div class='row'><button class='btn' data-act='link' data-id='${p.id}'>Configurar link</button><button class='btn' data-act='sim' data-id='${p.id}'>Simular compra</button><button class='btn primary' data-act='wallet' data-id='${p.id}'>Pagar con saldo</button></div><div class='meta' id='out-${p.id}' style='margin-top:8px'>—</div>`;grid.appendChild(el);});}document.querySelectorAll('button[data-method]').forEach(b=>{b.onclick=()=>{document.querySelectorAll('button[data-method]').forEach(x=>x.classList.remove('primary'));b.classList.add('primary');document.querySelectorAll('[id^="m-"]').forEach(x=>x.textContent=b.dataset.method);};});grid.addEventListener('click',e=>{const btn=e.target.closest('button[data-act]');if(!btn)return;const id=btn.dataset.id;const p=cfg.products.find(x=>x.id===id);const price=p.price[sel.value];const out=document.getElementById('out-'+id);if(btn.dataset.act==='link'){const url=`https://pay.mixtli.com/checkout?pid=${id}&cur=${sel.value}&amt=${price}`;out.textContent='Link configurado: '+url;q.textContent=`≈ ${(price/cfg.cryptoRates.BTC).toFixed(6)} BTC • ${(price/cfg.cryptoRates.ETH).toFixed(5)} ETH • ${(price/cfg.cryptoRates.USDC).toFixed(2)} USDC`;}else if(btn.dataset.act==='sim'){out.textContent='Compra simulada ✔ Recibiste '+p.gb+' GB.';}else if(btn.dataset.act==='wallet'){out.textContent='Saldo insuficiente (demo). Usa Simular compra.';}});sel.onchange=render;render();document.getElementById('modeLabel').textContent=(cfg.mode||'demo').toUpperCase();})();