*** apps/api/server.js.orig	2025-09-07
--- apps/api/server.js	2025-09-07
@@
+require('./observability/node/tracing').start();
+const requestId = require('./observability/node/middleware/requestId');
+const logger = require('./observability/node/middleware/logger');
+const { metricsRouter, instrument, httpRequestDuration } = require('./observability/node/metrics');
+const { initSentry, sentryRequestHandler, sentryErrorHandler } = require('./observability/node/sentry');
+initSentry();
@@
-const app = express();
+const app = express();
+app.use(requestId());
+app.use(logger());
+instrument(app);
+app.get('/salud', (req, res) => {
+  const end = httpRequestDuration.startTimer({ route: '/salud', method: 'GET' });
+  res.json({ ok: true, ts: new Date().toISOString() });
+  end({ status_code: 200 });
+});
+app.use('/metrics', metricsRouter);
@@
-app.listen(PORT, () => console.log(`API en puerto ${PORT}`));
+app.use(sentryRequestHandler());
+app.use(sentryErrorHandler());
+app.listen(PORT, () => console.log(`API en puerto ${PORT}`));
